1)
map ip из строки, затем map ip с 7 в (ip, 1), без 7ки в (ip, 0), и reduce
2)
map ip и data_size из строки в (ip, data_size), потом запускается reduce
3)
map час в (hour, 1), потом reduce. Фильтруются неправильные строки
4) 
собирются ip и страница в таблицу.
групируется по ip, считается количество записей для каждого ip, сортируется по количеству и выбирается первые 100 (most_active_ips)
из таблицы выбираются только записи c ip, который есть в most_active_ips.
групируется по page, сортируется, выводится на экран и записывается в файл
5) 
из каждой строки выбираются только друзья, то есть значения в фигурных скобках.
из них формируются все возможные пары, и делается map в ("друг_1 друг_2", 1).
так как значения упорядочены, то не обязательно руками упорядочивать.
далее reduce, и отбор топовых значений